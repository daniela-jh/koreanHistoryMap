{% extends 'khmap/navbar_formap.html' %}
{% block content %}
	<div id="map" style="width:100%;height:700px;"></div>

	<script type="text/javascript">
		var mapOptions = {
			center: new naver.maps.LatLng(37.5666103, 126.9783882),
			zoom: 5,
			maxZoom: 8,
		};

		var map = new naver.maps.Map('map', mapOptions);
		var contentMarkers = {},
			contentWindows = {};
		var markerIds = [];

		{% for locContent in contents %}

		markerIds.push({{ locContent.id }});

		var contentString = [
			'<div class="iw_inner iwCustom card">',
			'	<div class="card-body">',
			'		<h5 class="card-title"> <b> {{locContent.locationName}} </b> </h5>',
			'		<hr>',
			'		<p class="card-text"> {{locContent.locationText1}}<br>',
			'			{{locContent.locationText2}}<br>',
			'			{{locContent.locationText3}}<br>',
			'			{{locContent.locationText4}}<br>',
			'	</p>',
			'	</div>',
			'</div>'
		].join('');

		var position = new naver.maps.LatLng({{ locContent.locLat }}, {{ locContent.locLng }});

		var marker = new naver.maps.Marker({			
			map: map,
			position: position,
			title: "{{ locContent.locationName }}"		
		});
		marker.title = "{{ locContent.locationName }}"
		marker.id = "{{ locContent.locationName }}"

		var infowindow = new naver.maps.InfoWindow({
		    content: contentString,

		    maxWidth: 300,
			backgroundColor: "transparent",
			borderWidth: 0,
			anchorSize: new naver.maps.Size(10, 0),
			anchorSkew: false,

			pixelOffset: new naver.maps.Point(10, -10)
		});

		contentMarkers[{{ locContent.id }}] = marker;
		contentWindows[{{ locContent.id }}] = infowindow;



		{% endfor %}


		function getClickHandler(seq) {
			return function(e) {
				var marker = contentMarkers[seq],
					infoWindow = contentWindows[seq];

				if (infoWindow.getMap()) {
					infoWindow.close();
				} else {
					infoWindow.open(map, marker);
				}
			}
		}

		for (var i = 0 ; i < markerIds.length; i++) {
		    naver.maps.Event.addListener(contentMarkers[markerIds[i]], 'click', getClickHandler(markerIds[i]));
		}



		function showSearchInfo(seq) {			
			var marker, contentWindow, prevURL;

				var marker = contentMarkers[seq],
					contentWindow  = contentWindows[seq];
				var prevURL = window.location.href.indexOf(encodeURI(marker.title));
				if (prevURL == -1) {
					contentWindow.close();
				} else {
					contentWindow.open(map, marker);
				}
		};

		for (var i = 0 ; i < markerIds.length; i++) {
			naver.maps.Event.addListener(map, 'idle', showSearchInfo(markerIds[i]));
		};


	</script>
{% endblock %}